# HÆ°á»›ng dáº«n: Há»‡ thá»‘ng táº£i lÃªn vÃ  xem trÆ°á»›c tÃ i liá»‡u

## CÃ¡c loáº¡i file Ä‘Æ°á»£c há»— trá»£

### 1. **Táº£i lÃªn (Upload)**
Há»‡ thá»‘ng cho phÃ©p táº£i lÃªn cÃ¡c Ä‘á»‹nh dáº¡ng sau:

- **PDF** - `application/pdf`
- **Word** - `.doc`, `.docx`
- **Excel** - `.xls`, `.xlsx`
- **PowerPoint** - `.ppt`, `.pptx`
- **HÃ¬nh áº£nh** - `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`
- **VÄƒn báº£n** - `.txt`
- **File nÃ©n** - `.zip`, `.rar`, `.7z`

### 2. **Xem trÆ°á»›c (Preview)**

#### âœ… **Xem trá»±c tiáº¿p trong trÃ¬nh duyá»‡t:**
- **PDF** - Hiá»ƒn thá»‹ trong iframe
- **HÃ¬nh áº£nh** - Hiá»ƒn thá»‹ áº£nh gá»‘c
- **Text** - Hiá»ƒn thá»‹ ná»™i dung vÄƒn báº£n

#### ğŸ“„ **Xem qua Google Docs Viewer:**
- **Word (.doc, .docx)** - Nháº¥n "Xem qua Google Docs"
  - âš ï¸ **LÆ°u Ã½**: File cáº§n cÃ³ URL public Ä‘á»ƒ Google truy cáº­p
  - Náº¿u server cháº¡y localhost, chá»‰ cÃ³ thá»ƒ táº£i xuá»‘ng Ä‘á»ƒ xem

#### âŒ **KhÃ´ng há»— trá»£ xem trÆ°á»›c:**
- **File nÃ©n (RAR/ZIP/7z)** - Chá»‰ cÃ³ thá»ƒ táº£i xuá»‘ng
- **Excel, PowerPoint** - Chá»‰ cÃ³ thá»ƒ táº£i xuá»‘ng (hoáº·c dÃ¹ng Google Viewer náº¿u public)

---

## CÃ¡ch sá»­ dá»¥ng

### **A. Táº£i file lÃªn**

1. VÃ o trang **Táº¡o vÄƒn báº£n má»›i** hoáº·c **Chá»‰nh sá»­a vÄƒn báº£n**
2. KÃ©o tháº£ file vÃ o Ã´ "Files Ä‘Ã­nh kÃ¨m" hoáº·c nháº¥n **Browse** Ä‘á»ƒ chá»n file
3. CÃ³ thá»ƒ táº£i nhiá»u file cÃ¹ng lÃºc
4. Nháº¥n **LÆ°u vÄƒn báº£n** Ä‘á»ƒ hoÃ n táº¥t

### **B. Xem trÆ°á»›c file**

#### **Tá»« trang chi tiáº¿t vÄƒn báº£n:**

1. Má»Ÿ vÄƒn báº£n cáº§n xem
2. Cuá»™n xuá»‘ng pháº§n **"Files Ä‘Ã­nh kÃ¨m"**
3. Nháº¥n nÃºt **"Xem trÆ°á»›c"** bÃªn cáº¡nh tÃªn file

**MÃ n hÃ¬nh xem trÆ°á»›c sáº½ hiá»ƒn thá»‹:**

- **PDF**: Iframe vá»›i ná»™i dung PDF
- **HÃ¬nh áº£nh**: áº¢nh Ä‘áº§y Ä‘á»§
- **Text**: Ná»™i dung vÄƒn báº£n
- **Word**: Lá»±a chá»n:
  - **Táº£i xuá»‘ng**: Má»Ÿ báº±ng MS Word hoáº·c LibreOffice
  - **Xem qua Google Docs**: Má»Ÿ trong tab má»›i (chá»‰ khi server public)
- **File nÃ©n (RAR/ZIP)**: ThÃ´ng bÃ¡o khÃ´ng há»— trá»£ xem trÆ°á»›c + nÃºt táº£i xuá»‘ng

#### **Tá»« danh sÃ¡ch vÄƒn báº£n:**

1. Nháº¥n vÃ o icon **ğŸ“** (file Ä‘Ã­nh kÃ¨m) trÃªn dÃ²ng vÄƒn báº£n
2. Modal sáº½ hiá»ƒn thá»‹ danh sÃ¡ch files
3. Nháº¥n **"Xem trÆ°á»›c"** hoáº·c **"Táº£i vá»"**

### **C. Táº£i file vá»**

- Nháº¥n nÃºt **"Táº£i vá»"** bÃªn cáº¡nh file
- File sáº½ Ä‘Æ°á»£c táº£i vá» vá»›i **tÃªn gá»‘c** (bao gá»“m kÃ½ tá»± Unicode/tiáº¿ng Viá»‡t)

---

## Icon hiá»ƒn thá»‹ theo loáº¡i file

Há»‡ thá»‘ng tá»± Ä‘á»™ng nháº­n diá»‡n vÃ  hiá»ƒn thá»‹ icon:

| Icon | Loáº¡i file | MÃ u ná»n |
|------|-----------|---------|
| ğŸ“• | PDF | Äá» nháº¡t |
| ğŸ“˜ | Word | Xanh dÆ°Æ¡ng |
| ğŸ“— | Excel | Xanh lÃ¡ |
| ğŸ–¼ï¸ | HÃ¬nh áº£nh | TÃ­m nháº¡t |
| ğŸ“¦ | File nÃ©n (RAR/ZIP) | Cam nháº¡t |
| ğŸ“„ | Text | XÃ¡m nháº¡t |

---

## Giá»›i háº¡n & LÆ°u Ã½

### **KÃ­ch thÆ°á»›c file:**
- Tá»‘i Ä‘a **10 MB** má»—i file (cÃ³ thá»ƒ Ä‘iá»u chá»‰nh trong `.env` vá»›i `MAX_FILE_SIZE`)

### **Báº£o máº­t:**
- Má»i file Ä‘Æ°á»£c lÆ°u trong thÆ° má»¥c `public/uploads/documents/`
- TÃªn file Ä‘Æ°á»£c mÃ£ hÃ³a unique: `doc_<timestamp>_<random>_<ten_goc>.ext`
- Chá»‰ ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p má»›i cÃ³ thá»ƒ táº£i lÃªn/xem file

### **Xem trÆ°á»›c Word qua Google Docs:**
- **Chá»‰ hoáº¡t Ä‘á»™ng khi:**
  - Server cÃ³ Ä‘á»‹a chá»‰ public (khÃ´ng pháº£i `localhost`)
  - File cÃ³ thá»ƒ truy cáº­p qua Internet
- **TrÃªn localhost**: Chá»‰ cÃ³ thá»ƒ táº£i xuá»‘ng Ä‘á»ƒ xem

### **Encoding tÃªn file:**
- TÃªn file tiáº¿ng Viá»‡t Ä‘Æ°á»£c há»— trá»£ Ä‘áº§y Ä‘á»§ (UTF-8)
- Khi táº£i vá», tÃªn file giá»¯ nguyÃªn kÃ½ tá»± Ä‘áº·c biá»‡t

---

## Xá»­ lÃ½ lá»—i thÆ°á»ng gáº·p

### **"ÄÆ°á»ng dáº«n khÃ´ng há»£p lá»‡"**
- **NguyÃªn nhÃ¢n**: File khÃ´ng náº±m trong thÆ° má»¥c upload Ä‘Æ°á»£c phÃ©p
- **Giáº£i phÃ¡p**: LiÃªn há»‡ admin kiá»ƒm tra cáº¥u hÃ¬nh `UPLOAD_PATH` trong `.env`

### **"File khÃ´ng há»— trá»£ xem trÆ°á»›c"**
- **NguyÃªn nhÃ¢n**: Loáº¡i file khÃ´ng thuá»™c danh sÃ¡ch previewable
- **Giáº£i phÃ¡p**: Táº£i file vá» Ä‘á»ƒ xem báº±ng á»©ng dá»¥ng tÆ°Æ¡ng á»©ng

### **Google Docs Viewer khÃ´ng má»Ÿ Ä‘Æ°á»£c Word**
- **NguyÃªn nhÃ¢n**: Server cháº¡y localhost hoáº·c file khÃ´ng public
- **Giáº£i phÃ¡p**: Táº£i file vá» vÃ  má»Ÿ báº±ng MS Word/LibreOffice

### **Upload tháº¥t báº¡i**
- **Kiá»ƒm tra**:
  - File cÃ³ vÆ°á»£t quÃ¡ 10MB khÃ´ng?
  - Äá»‹nh dáº¡ng file cÃ³ Ä‘Æ°á»£c phÃ©p khÃ´ng?
  - ThÆ° má»¥c `public/uploads/documents/` cÃ³ quyá»n ghi khÃ´ng?

---

## API Endpoints (Developer)

### **Upload file (khi táº¡o/sá»­a vÄƒn báº£n):**
```
POST /documents (táº¡o má»›i)
POST /documents/:id (cáº­p nháº­t)
Content-Type: multipart/form-data
Field: attachments[]
```

### **Láº¥y danh sÃ¡ch files:**
```
GET /documents/files/:documentId
Response: { success: true, data: [...] }
```

### **Xem thÃ´ng tin preview:**
```
GET /documents/files/:fileId/preview-info
Response: {
  success: true,
  filename: "...",
  type: "pdf|word|image|text|archive|other",
  size: 12345,
  previewable: true/false,
  content: "..." (chá»‰ vá»›i text)
}
```

### **Stream file preview:**
```
GET /documents/files/:fileId/preview
Headers: Content-Type: <mime_type>
```

### **Táº£i file:**
```
GET /documents/files/:fileId/download
Headers: Content-Disposition: attachment; filename*=UTF-8''<encoded_name>
```

---

## Cáº¥u hÃ¬nh nÃ¢ng cao

### **TÄƒng giá»›i háº¡n kÃ­ch thÆ°á»›c file:**

Sá»­a file `.env`:
```env
MAX_FILE_SIZE=20971520  # 20MB (tÃ­nh báº±ng bytes)
```

### **ThÃªm Ä‘á»‹nh dáº¡ng file má»›i:**

1. Má»Ÿ `config/app.js`
2. ThÃªm MIME type vÃ o `allowedTypes`:
```javascript
allowedTypes: [
  'application/vnd.ms-access',  // MS Access
  // ...
]
```

3. Cáº­p nháº­t `app/utils/fileTypeHelper.js` náº¿u muá»‘n thÃªm icon riÃªng

### **KÃ­ch hoáº¡t xem Word trá»±c tiáº¿p (nÃ¢ng cao):**

YÃªu cáº§u:
- CÃ i thÃªm thÆ° viá»‡n chuyá»ƒn Ä‘á»•i (vÃ­ dá»¥: `libreoffice-convert`, `mammoth`)
- Xá»­ lÃ½ chuyá»ƒn Word â†’ HTML hoáº·c PDF trÆ°á»›c khi preview

---

**PhiÃªn báº£n**: 1.0  
**Cáº­p nháº­t**: ThÃ¡ng 10/2025
