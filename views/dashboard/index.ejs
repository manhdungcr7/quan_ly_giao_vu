<%- contentFor('css') %>
<link rel="stylesheet" href="/css/dashboard.css">

<% 
// Dashboard sử dụng layout chính với sidebar
const layout = '../layouts/main';
const notificationItems = [
    ...((notifications && notifications.upcomingDeadlines) || []),
    ...((notifications && notifications.overdueDocuments) || [])
].slice(0, 4);
const documentItems = (recentDocuments || []).slice(0, 4);
%>

<div class="app-content">
<div class="dashboard-shell">
    <header class="dashboard-shell__header">
        <div class="dashboard-heading">
            <h1>Trang chủ</h1>
            <p>Chào mừng quay trở lại, <%= user.fullName || user.full_name || user.username %></p>
        </div>
        <span class="status-chip status-chip--online">Trực tuyến</span>
    </header>

    <section class="dashboard-summary">
        <% summaryCards.forEach(function(card){ %>
            <article class="summary-card summary-card--<%= card.color %>">
                <span class="summary-card__marker"></span>
                <div class="summary-card__value"><%= card.value || 0 %></div>
                <div class="summary-card__title"><%= card.title %></div>
                <div class="summary-card__desc"><%= card.subtitle %></div>
            </article>
        <% }) %>
    </section>

    <section class="dashboard-grid">
        <div class="dashboard-grid__primary">
            <article class="panel panel--operations">
                <header class="panel__header">
                    <div>
                        <h2>Điều hành nhanh</h2>
                        <p>Truy cập tức thì vào các phân hệ chính</p>
                    </div>
                </header>
                <div class="quick-actions">
                    <% quickActions.forEach(function(action){ %>
                        <a class="quick-actions__item quick-actions__item--<%= action.color %>" href="<%= action.href %>">
                            <span><%= action.label %></span>
                        </a>
                    <% }) %>
                </div>
                <section class="progress-board">
                    <header>
                        <h3>Tiến độ xử lý</h3>
                        <span>Cập nhật theo số liệu mới nhất</span>
                    </header>
                    <div class="progress-board__list">
                        <% progressOverview.forEach(function(metric){ %>
                            <div class="progress-pill">
                                <div class="progress-pill__header">
                                    <span><%= metric.title %></span>
                                    <strong><%= metric.value %></strong>
                                </div>
                                <div class="progress-pill__bar">
                                    <span class="progress-pill__fill progress-pill__fill--<%= metric.color %>" style="--progress-fill:<%= metric.percent %>;"></span>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </section>
            </article>

            <article class="panel panel--activity">
                <header class="panel__header">
                    <div>
                        <h2>Hoạt động gần đây</h2>
                        <span>Nhật ký thao tác mới nhất</span>
                    </div>
                </header>
                <div class="timeline">
                    <% if (recentActivities && recentActivities.length) { %>
                        <% recentActivities.forEach(function(activity){ %>
                            <div class="timeline__item">
                                <div class="timeline__dot"></div>
                                <div class="timeline__content">
                                    <h4><%= activity.title %></h4>
                                    <p><%= activity.description %></p>
                                    <% if (activity.time) { %>
                                        <span class="timeline__time"><%= activity.time %></span>
                                    <% } %>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="placeholder-text">Chưa có hoạt động nào gần đây.</p>
                    <% } %>
                </div>
            </article>

            <article class="panel panel--documents">
                <header class="panel__header">
                    <div>
                        <h2>Tài liệu đang xử lý</h2>
                        <span>Danh sách gán cho bạn hoặc đơn vị</span>
                    </div>
                </header>
                <div class="document-stack">
                    <% if (documentItems.length) { %>
                        <% documentItems.forEach(function(doc){ %>
                            <div class="document-card">
                                <div class="document-card__marker"></div>
                                <div class="document-card__body">
                                    <h4><%= doc.title || doc.document_number || 'Tài liệu' %></h4>
                                    <% if (doc.processing_deadline) { %>
                                        <span class="document-card__meta">Hạn xử lý: <%= doc.processing_deadline %></span>
                                    <% } %>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="placeholder-text">Không có tài liệu nào đang được giao.</p>
                    <% } %>
                </div>
            </article>
        </div>

        <div class="dashboard-grid__secondary">
            <article class="panel panel--notifications">
                <header class="panel__header">
                    <div>
                        <h2>Thông báo nội bộ</h2>
                        <span>Tự động tổng hợp hạn xử lý và công việc</span>
                    </div>
                </header>
                <div class="notification-list">
                    <% if (notificationItems.length) { %>
                        <% notificationItems.forEach(function(item){ %>
                            <div class="notification-card">
                                <div class="notification-card__badge <%= item.badgeColor || (item.status === 'overdue' ? 'is-danger' : '') %>">
                                </div>
                                <div class="notification-card__body">
                                    <h4><%= item.title || item.document_number || 'Thông báo' %></h4>
                                    <p><%= item.content_summary || 'Tài liệu sắp đến hạn xử lý, vui lòng kiểm tra.' %></p>
                                    <% if (item.processing_deadline) { %>
                                        <span class="notification-card__meta">Hạn: <%= item.processing_deadline %></span>
                                    <% } %>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="placeholder-text">Chưa có thông báo mới.</p>
                    <% } %>
                </div>
            </article>

            <article class="panel panel--schedule">
                <header class="panel__header">
                    <div>
                        <h2>Lịch tuần (cá nhân)</h2>
                        <span>Lịch họp và công tác sắp tới</span>
                    </div>
                </header>
                <div class="schedule-board">
                    <% if (scheduleEvents && scheduleEvents.length) { %>
                        <% scheduleEvents.forEach(function(event){ %>
                            <div class="schedule-board__item">
                                <strong><%= event.title %></strong>
                                <% if (event.timeRange) { %>
                                    <span><%= event.timeRange %></span>
                                <% } %>
                                <% if (event.location) { %>
                                    <span><%= event.location %></span>
                                <% } %>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="placeholder-text">Không có lịch công tác nào trong tuần.</p>
                    <% } %>
                </div>
            </article>

            <article class="panel panel--reminders">
                <header class="panel__header">
                    <div>
                        <h2>Nhắc việc</h2>
                        <span>Sắp xếp theo mức ưu tiên</span>
                    </div>
                </header>
                <div class="reminder-grid">
                    <% if (reminders && reminders.length) { %>
                        <% reminders.forEach(function(reminder){ %>
                            <div class="reminder-pill">
                                <div class="reminder-pill__header">
                                    <span class="reminder-pill__badge reminder-pill__badge--<%= reminder.badgeColor %>"><%= reminder.badge %></span>
                                    <span class="reminder-pill__priority">Ưu tiên: <strong><%= reminder.priority %></strong></span>
                                </div>
                                <h4><%= reminder.title %></h4>
                                <p><%= reminder.description %></p>
                                <% if (reminder.deadline) { %>
                                    <span class="reminder-pill__deadline">Hạn: <%= reminder.deadline %></span>
                                <% } %>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="placeholder-text">Không có nhắc việc nào.</p>
                    <% } %>
                </div>
            </article>
        </div>
    </section>
</div>
</div>